<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>裝機單管理</title>
    <meta charset="utf-8" />
    <link href="jqwidgets/styles/jqx.base.css" rel="stylesheet" />
    <link href="jqwidgets/styles/jqx.orange.css" rel="stylesheet" />
    <link href="jqwidgets/styles/jqx.office.css" rel="stylesheet" />
    <link href="jqwidgets/styles/jqx.energyblue.css" rel="stylesheet" />
    <!--<link href="jqwidgets/styles/jqx.energyblue2.css" rel="stylesheet" />-->
    <link href="jqwidgets/styles/jqx.ui-lightness.css" rel="stylesheet" />
    <!--<link href="jqwidgets/styles/jqx.ui-sunny2.css" rel="stylesheet" />
    <link href="jqwidgets/styles/jqx.ui-start2.css" rel="stylesheet" />
    <link href="jqwidgets/styles/jqx.ui-lightness2.css" rel="stylesheet" />
    <link href="jqwidgets/styles/jqx.darkblue2.css" rel="stylesheet" />-->
    <link href="jqwidgets/styles/jqx.ui-redmond2.css" rel="stylesheet" />
    <style>
        * {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            font-size: 12px;
        }

        input:focus {
            background: #E0E9F5;
        }

        .csslEditMode {
            background-color: #FFFF99;
            border-color: white;
            width: 60px;
            height: 25px;
            text-align: center;
            padding: 6px;
        }

        textarea:focus {
            background: #E0E9F5;
        }
    </style>
    <script type="text/javascript" src="scripts/jquery-3.3.1.min.js"></script>
    <!--<script type="text/javascript" src="Scripts/json2.js"></script>-->
    <script type="text/javascript" src="component/jqx-all2.js"></script>
    <script type="text/javascript" src="jqwidgets/globalization/globalize.js"></script>
    <script type="text/javascript" src="component/csList.js"></script>
    <script type="text/javascript" src="component/csMulti.js"></script>
    <script src="component/csDateTime.js"></script>
    <script src="component/csTabs.js"></script>
    <script src="component/csWindow.js"></script>
    <script src="component/csAddress1.js"></script>
    <script src="component/csAddress2.js"></script>
    <script src="SO1000/WipUtility.js"></script>
    <script src="SO1000/SO1111A.js"></script>
    <script src="SO1000/SO1113A.js"></script>
    <script src="SO1000/SO1113A1.js"></script>
    <script src="SO1000/SO1113B.js"></script>
    <script src="SO1000/SO1113C.js"></script>
    <script src="SO1000/SO1114A.js"></script>
    <script src="SO1000/SO1115A.js"></script>
    <script src="SO1000/SO111FA.js"></script>
    <script src="SO1000/SO1132A.js"></script>
    <script src="SO1000/SO1131E.js"></script>
    <script src="SO1000/SO1132B.js"></script>
    <script src="SO1000/SO1132B1.js"></script>
    <script src="SO1000/SO1132A1.js"></script>
    <script src="SO1000/SO1120A9.js"></script>
    <script src="SO1000/SO1120A8.js"></script>
    <script src="SO1000/SO1120A7.js"></script>
    <script src="SO1000/SO1120A6.js"></script>
    <script src="SO1000/SO1120A5.js"></script>
    <script src="SO1000/SO1120A4.js"></script>
    <script src="SO1000/SO1120A3.js"></script>
    <script src="SO1000/SO1120A2.js"></script>
    <script src="SO1000/SO1120A1.js"></script>
    <script src="SO1000/SO1120A.js"></script>
    <script src="SO1000/SO111XD.js"></script>
    <script src="language/zh-TW/language01.js"></script>
    <script src="language/zh-TW/language21.js"></script>
    <script src="language/zh-TW/language31.js"></script>
    <script src="language/zh-TW/language51.js"></script>
    <script src="language/zh-TW/language52.js"></script>
    <script src="language/zh-TW/language61.js"></script>
    <script src="language/zh-TW/language71.js"></script>
    <script src="Scripts/CryptoJS v3.1.2/rollups/aes.js"></script>
    <!--<script src="Scripts/CryptoJS v3.1.2/components/mode-ecb-min.js"></script>
    <script src="Scripts/CryptoJS v3.1.2/components/pad-iso10126-min.js"></script>-->
    <script src="Utility/utility.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            //alert(maskData("陳榮貴", "name"));
            //alert(maskData("12345678901234", "account"));
            //alert(maskData("A1222222221", "id"));
            //alert(maskData("高雄市苓雅區光華一路123號", "address"));
            //alert(maskData("5551234", "tel"));
            //$ = jQuery = window.jQuery.noConflict(true);
            //var d = new Date('2016/08/23 16:04');
            //alert(d.toJSON());
            ////alert(formatDateTime(d) + "," + d.getTimezoneOffset());
            //return;
            //try {
            //    //$.cs.Utility('messageBox', 'TEST');
            //    alert($.utility.formatDateTime(new Date(), 'datetime'));
            //    //alert($.cs.utility('formatDateTime',new Date(),'datetime'));
            //}
            //catch (err) {
            //    alert(err);
            //}
            //$('#csDateTime').on('dateChanged', function () {
            //    alert('valueChanged');
            //});
            //$('#csDateTime').csDateTime({ formatString: 'yyyy/MM/dd HH:mm' });
            ////, inputMode: 'simple'
            ////$('#csDateTime').csDateTime('setText', '');
            //return;
            //return;
            //var data = {
            //    columns: [{ name: 'CUSTID', type: 'integer' },
            //            { name: 'AMOUNT', type: 'decimal' }
            //    ],
            //    rows: [{
            //        CUSTID: 3,
            //        AMOUNT: 500,
            //    }, {
            //        CUSTID: 3,
            //        AMOUNT: 600
            //    }]
            //};
            //var total = 0;
            //for (var i = 0; i < data.rows.length; i++) {
            //    total += data.rows[i]['AMOUNT'];
            //}
            //return;
            var init = function () {
                try {
                    var loginInfo = {
                        loginInfo: {
                            columns: [{ name: 'compcode', type: 'integer' },
                                { name: 'entryid', type: 'string' },
                                { name: 'entryname', type: 'string' },
                                { name: 'groupid', type: 'string' }
                            ],
                            rows: [{
                                compcode: 1,
                                entryid: 'DEBBY18',
                                entryname: 'DEBBY18',
                                groupid: '50'
                            }]
                        }
                    };
                    $('#custId').val('300');
                    $('#serviceType').val('C');
                    $('#sno').val('201705IC2173409');
                    var getInstData = (function () {
                        var custId = $('#custId').val();
                        var servCode = '';
                        var serviceType = $('#serviceType').val();
                        var sno = $('#sno').val();
                        var x = "\"";
                        var dsData = {
                            customer: {
                                columns: [{ name: 'CUSTID', type: 'integer' },
                                    { name: 'CUSTNAME', type: 'string' },
                                    { name: 'SERVCODE', type: 'string' },
                                ],
                                rows: [{
                                    CUSTID: custId,
                                    CUSTNAME: '無',
                                    SERVCODE: servCode,
                                }]
                            },
                            install: {
                                columns: [{ name: 'CUSTID', type: 'integer' },
                                    { name: 'SNO', type: 'string' },
                                    { name: 'SERVICETYPE', type: 'string' }
                                ],
                                rows: [{
                                    CUSTID: custId,
                                    SNO: sno,
                                    SERVICETYPE: serviceType,
                                }]
                            }
                        };
                        var xx = dsData['customer'];
                        var keys = Object.keys(dsData);
                        return dsData;
                    });
                    var getCloseData = (function () {
                        var custId = $('#custId').val();
                        var servCode = '';
                        var serviceType = $('#serviceType').val();
                        var sno = $('#sno').val();
                        var x = "\"";
                        var dsData = {
                            customer: {
                                columns: [{ name: 'CUSTID', type: 'integer' },
                                    { name: 'CUSTNAME', type: 'string' },
                                    { name: 'SERVCODE', type: 'string' },
                                ],
                                rows: [{
                                    CUSTID: custId,
                                    CUSTNAME: '無',
                                    SERVCODE: servCode,
                                }]
                            },
                            ChargeClose: {
                                columns: [{ name: 'CUSTID', type: 'integer' },
                                    { name: 'SNO', type: 'string' },
                                    { name: 'SERVICETYPE', type: 'string' }
                                ],
                                rows: [{
                                    CUSTID: custId,
                                    SNO: sno,
                                    SERVICETYPE: serviceType,
                                }]
                            }
                        };
                        return dsData;
                    });
                    var getPRData = (function () {
                        var custId = $('#custId').val();
                        var servCode = '';
                        var serviceType = $('#serviceType').val();
                        var sno = $('#sno').val();
                        var x = "\"";
                        var dsData = {
                            customer: {
                                columns: [{ name: 'CUSTID', type: 'integer' },
                                    { name: 'CUSTNAME', type: 'string' },
                                    { name: 'SERVCODE', type: 'string' },
                                ],
                                rows: [{
                                    CUSTID: custId,
                                    CUSTNAME: '無',
                                    SERVCODE: servCode,
                                }]
                            },
                            PR: {
                                columns: [{ name: 'CUSTID', type: 'integer' },
                                    { name: 'SNO', type: 'string' },
                                    { name: 'SERVICETYPE', type: 'string' }
                                ],
                                rows: [{
                                    CUSTID: custId,
                                    //SNO: sno,
                                    SERVICETYPE: serviceType,
                                }]
                            }
                        };
                        return dsData;
                    });
                    // messageBox(JSON.stringify(getInstData(), null, "\t"));
                    //秀出form2 並傳參數
                    //$.jqx.theme = "office";
                    //$.jqx.theme = "energyblue2";
                    $.jqx.theme = "ui-redmond2";
                    //$.jqx.theme = "office";
                    if ($("#xxx").length == 0) {
                        // alert(0);
                    }
                    var localization = getLocalization('zh-TW');
                    //$('#Text1').jqxInput({ width: 120, height: 25 });
                    var params = getParameters('getKey', 'getKey', 'getKey', loginInfo);
                    var showInstForm = (function (em, inData) {
                        try {
                            var divName = 'div' + getUniqueId();
                            var div2Name = 'div' + getUniqueId();
                            $('<div id="' + divName + '"><div>測試Form</div><div id="' + div2Name + '"></div></div>').appendTo('body');
                            var div = $('#' + divName);

                            $('#' + divName).csWindow($.extend({}, {
                                width: 1000,
                                height: 600,
                                minHeight: 200,
                                minWidth: 600,
                                maxWidth: $(document).innerWidth(),
                                maxHeight: $(document).innerHeight(),
                                resizable: true,
                                haveClosing: true
                            }));
                            $('#' + div2Name)['SO1111A']($.extend({}, {
                                loginInfo: cloneJSON(loginInfo),
                                container: $('#' + divName),
                                localization: localization,
                                parameters: inData,
                                editMode: em,

                                //wipRefNoStr: "1,2,5",
                                //isChild: true
                            }));
                            if ($('#' + div2Name).length > 0) {
                                // alert($('#' + div2Name).length);
                            }
                            $('[data-id=changeTheme]').on('click', function () {
                                if ($('#' + divName).csWindow('theme') == 'office') {
                                    $('#' + divName).csWindow('theme', 'energyblue');
                                    $('#' + div2Name).SO1111A('theme', 'energyblue');
                                }
                                else {
                                    $('#' + divName).csWindow('theme', 'office');
                                    $('#' + div2Name).SO1111A('theme', 'office');
                                }
                            });

                            $('#' + divName).on('close', function (event) {
                                var options = $('#' + div2Name).SO1111A('options');
                                messageBox(JSON.stringify(options.wipData, null, "\t"));
                                $('#' + div2Name).SO1111A('destroy');
                                $('#' + divName).csWindow('destroy');
                            });
                        }
                        catch (err) {
                            alert(err);
                        }
                    });
                    var showCloseForm = (function (em, inData) {
                        try {
                            var divName = 'div' + getUniqueId();
                            var div2Name = 'div' + getUniqueId();
                            $('<div id="' + divName + '"><div>測試Form</div><div id="' + div2Name + '"></div></div>').appendTo('body');
                            var div = $('#' + divName);

                            $('#' + divName).csWindow($.extend({}, {
                                width: 1000,
                                height: 600,
                                minHeight: 200,
                                minWidth: 600,
                                maxWidth: $(document).innerWidth(),
                                maxHeight: $(document).innerHeight(),
                                resizable: true,
                                haveClosing: true
                            }));
                            $('#' + div2Name)['SO1132B']($.extend({}, {
                                loginInfo: cloneJSON(loginInfo),
                                container: $('#' + divName),
                                localization: localization,
                                parameters: inData,
                                editMode: editMode.view,
                                refNo: 16
                            }));
                            if ($('#' + div2Name).length > 0) {
                                // alert($('#' + div2Name).length);
                            }
                            $('[data-id=changeTheme]').on('click', function () {
                                if ($('#' + divName).csWindow('theme') == 'office') {
                                    $('#' + divName).csWindow('theme', 'energyblue');
                                    $('#' + div2Name).SO1132B('theme', 'energyblue');
                                }
                                else {
                                    $('#' + divName).csWindow('theme', 'office');
                                    $('#' + div2Name).SO1132B('theme', 'office');
                                }
                            });

                            $('#' + divName).on('close', function (event) {
                                var options = $('#' + div2Name).SO1132B('options');
                                messageBox(JSON.stringify(options.wipData, null, "\t"));
                                $('#' + div2Name).SO1132B('destroy');
                                $('#' + divName).csWindow('destroy');
                            });
                        }
                        catch (err) {
                            alert(err);
                        }
                    });
                    var showPRForm = (function (em, inData) {
                        try {
                            var divName = 'div' + getUniqueId();
                            var div2Name = 'div' + getUniqueId();
                            $('<div id="' + divName + '"><div>測試Form</div><div id="' + div2Name + '"></div></div>').appendTo('body');
                            var div = $('#' + divName);

                            $('#' + divName).csWindow($.extend({}, {
                                width: 1000,
                                height: 600,
                                minHeight: 200,
                                minWidth: 600,
                                maxWidth: $(document).innerWidth(),
                                maxHeight: $(document).innerHeight(),
                                resizable: true,
                                haveClosing: true
                            }));
                            $('#' + div2Name)['SO1113A']($.extend({}, {
                                loginInfo: cloneJSON(loginInfo),
                                container: $('#' + divName),
                                localization: localization,
                                parameters: inData,
                                editMode: editMode.view
                            }));
                            if ($('#' + div2Name).length > 0) {
                                // alert($('#' + div2Name).length);
                            }
                            $('[data-id=changeTheme]').on('click', function () {
                                if ($('#' + divName).csWindow('theme') == 'office') {
                                    $('#' + divName).csWindow('theme', 'energyblue');
                                    $('#' + div2Name).SO1113A('theme', 'energyblue');
                                }
                                else {
                                    $('#' + divName).csWindow('theme', 'office');
                                    $('#' + div2Name).SO1113A('theme', 'office');
                                }
                            });

                            $('#' + divName).on('close', function (event) {
                                var options = $('#' + div2Name).SO1113A('options');
                                messageBox(JSON.stringify(options.wipData, null, "\t"));
                                $('#' + div2Name).SO1113A('destroy');
                                $('#' + divName).csWindow('destroy');
                            });
                        }
                        catch (err) {
                            alert(err);
                        }
                    });
                    var chkInstShow = (function (em, inData, action, fm) {
                        try {
                            var method;
                            switch (em) {
                                case editMode.append:
                                    method = "canAppend";
                                    break;
                                case editMode.edit:
                                    method = "canEdit";
                                    break;
                                case editMode.view:
                                    method = "canView";
                                    break;
                                case editMode.delete:
                                    method = "canDelete";
                                    break;

                            }
                            if (fm == null) fm = "SO1111A";
                            $.fn[fm](method, $.extend({}, loginInfo, inData), action);
                        }
                        catch (err) {
                            alert(err);
                        }
                    });
                    var canDo = (function (data) {
                        try {
                            $('[data-id=btnAppend]').on('click', function () {
                                var inData = getInstData();
                                chkInstShow(editMode.append, inData, function (d) {
                                    if (d[0] == false) {
                                        messageBox(d[1]);
                                    }
                                    else {
                                        showInstForm(editMode.append, inData);
                                    }
                                });
                            });
                            $('[data-id=btnEdit]').on('click', function () {
                                var inData = getInstData();
                                chkInstShow(editMode.edit, inData, function (d) {
                                    if (d[0] == false) {
                                        messageBox(d[1]);
                                    }
                                    else {
                                        showInstForm(editMode.edit, inData);
                                    }
                                });
                            });
                            $('[data-id=btnView]').on('click', function () {
                                var inData = getInstData();
                                chkInstShow(editMode.view, inData, function (d) {
                                    if (d[0] == false) {
                                        messageBox(d[1]);
                                    }
                                    else {
                                        showInstForm(editMode.view, inData);
                                    }
                                });
                            });
                            $('[data-id=btnDelete]').on('click', function () {
                                var inData = getInstData();
                                chkInstShow(editMode.delete, inData, function (d) {
                                    if (d[0] == false) {
                                        messageBox(d[1]);
                                    }
                                    else {
                                        showInstForm(editMode.delete, inData);
                                    }
                                });
                            });
                            $('[data-id=btnChangeCMRate]').on('click', function () {
                                var inData = getCloseData();
                                showCloseForm(editMode.append, inData);
                            });
                            $('[data-id=btnMoveFaci]').on('click', function () {
                                var inData = getPRData();
                                chkInstShow(editMode.append, inData, function (d) {
                                    if (d[0] == false) {
                                        messageBox(d[1]);
                                    }
                                    else {
                                        showPRForm(editMode.append, inData);
                                    }
                                }, "SO1113A");
                            });
                        }
                        catch (err) {
                            alert(err.stack);
                        }
                    });

                    getServerData(params, { success: canDo });
                }
                catch (err) {
                    alert(err.stack);
                }
            }
            init();
        });

    </script>

</head>
<body>
    <div id="maindiv">
        <table>
            <tr>
                <td>
                    客編
                </td>
                <td>

                    <input id="custId" type="text" />
                </td>
            </tr>
            <tr>
                <td>
                    工單單號
                </td>
                <td>
                    <input id="sno" type="text" />
                </td>
            </tr>
            <tr>
                <td>
                    服務別
                </td>
                <td>
                    <input id="serviceType" type="text" title="TEST" />
                </td>
            </tr>
            <tr>
                <td>
                    測試日期
                </td>
                <td>
                    <input id="csDateTime" type="text" />
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <input data-id="btnAppend" type="button" value="新增" />
                    <input data-id="btnEdit" type="button" value="修改" />
                    <input data-id="btnView" type="button" value="顯示" />
                    <input data-id="btnDelete" type="button" value="刪除" />
                    <input data-id="btnChangeCMRate" type="button" value="CM升降速" />
                    <input data-id="btnMoveFaci" type="button" value="同區移機" />
                    <input data-id="changeTheme" type="button" value="改佈景" />
                </td>
            </tr>
        </table>
    </div>
</body>
</html>
